<!DOCTYPE html>
<html lang="en">

<head>

  <!-- SITE TITTLE -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>big bags-Online Shopping India</title>

  <!-- PLUGINS CSS STYLE -->
  <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href='assets/plugins/fontawesome-5.15.2/css/all.min.css' rel='stylesheet'>
  <link href='assets/plugins/fontawesome-5.15.2/css/fontawesome.min.css' rel='stylesheet'>
  <link href='assets/plugins/material/css/materialdesignicons.min.css' rel='stylesheet' />
  <link href="assets/plugins/animate/animate.css" rel="stylesheet">
  <link href='assets/plugins/simplebar/simplebar.css' rel='stylesheet' />

  <link href='assets/plugins/selectbox/select_option1.css' rel='stylesheet'>


  <link href='assets/plugins/iziToast/css/iziToast.css' rel='stylesheet'>


  <link rel='stylesheet' type='text/css' href='assets/plugins/slick/slick.css' media='screen'>
  <link rel='stylesheet' type='text/css' href='assets/plugins/slick/slick-theme.css' media='screen'>

  <!-- CUSTOM CSS -->
  <link href="assets/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/default.css" id="option_style">

  <!-- Icons -->
  <!-- <link rel="icon" href="/public/assets/img/favicon.png"> -->
  <link rel="icon" type="image/png" href="assets/img/favicon.png">


  <!-- form validate -->
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/jquery.validate.min.js"
    integrity="sha512-WMEKGZ7L5LWgaPeJtw9MBM4i5w5OSBlSjTjCtSnvFJGSVD26gE5+Td12qN5pvWXhuWaWcVwF++F7aqu9cvqP0A=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/additional-methods.min.js"
    integrity="sha512-TiQST7x/0aMjgVTcep29gi+q5Lk5gVTUPE9XgN0g96rwtjEjLpod4mlBRKWHeBcvGBAEvJBmfDqh2hfMMmg+5A=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</head>
<!-- TOPBAR -->


<!-- NAVBAR -->
<nav class="navbar navbar-main navbar-default navbar-expand-md navbar-scrollUp navbar-sticky d-none d-md-block"
  role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <img src="assets/img/logo1.png" alt="gg">
    <h1></h1>


    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".navbar-ex1-collapse"
      aria-controls="navbar-ex1-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="fa fa-bars"></span>
    </button>


    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav ms-auto">
        <li class="nav-item dropdown megaDropMenu ">
          <a href="/admin" class="dropdown-toggle nav-link" data-toggle="dropdown" data-hover="dropdown"
            data-delay="300" data-close-others="true" aria-expanded="false">Home</b></a>

        </li>
        <li class="nav-item dropdown megaDropMenu ">
          <a href="/usermanagement" class="dropdown-toggle nav-link" data-toggle="dropdown" data-hover="dropdown"
            data-delay="300" data-close-others="true" aria-expanded="false">Users</b></a>

        </li>
        <li class="nav-item dropdown megaDropMenu ">
          <a href="/category" class="dropdown-toggle nav-link" data-toggle="dropdown" data-hover="dropdown"
            data-delay="300" data-close-others="true" aria-expanded="false">Category</b></a>

        </li>
        <li class="nav-item dropdown megaDropMenu ">
          <a href="/product" class="dropdown-toggle nav-link" data-toggle="dropdown" data-hover="dropdown"
            data-delay="300" data-close-others="true" aria-expanded="false">Products</b></a>

        </li>
        <li class="nav-item ">
          <form action="/adminlogout" method="post">
            <button class="btn btn-danger btn-lg px-3" type="submit">Logout</button>
          </form>

        </li>

      </ul>
    </div><!-- /.navbar-collapse -->

  </div>
</nav>
</div>


<body>
  <style>
    .error {
      color: red;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/jquery.validate.min.js"
    integrity="sha512-WMEKGZ7L5LWgaPeJtw9MBM4i5w5OSBlSjTjCtSnvFJGSVD26gE5+Td12qN5pvWXhuWaWcVwF++F7aqu9cvqP0A=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/additional-methods.min.js"
    integrity="sha512-TiQST7x/0aMjgVTcep29gi+q5Lk5gVTUPE9XgN0g96rwtjEjLpod4mlBRKWHeBcvGBAEvJBmfDqh2hfMMmg+5A=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>



  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">

    </div>
  </nav>
  <button style="margin-top: 80px;" type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
    Open Modal
  </button>
  <div class="modal" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Product Details</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <!-- Modal Body -->
        <form id="productForm">
          <div class="modal-body">
            <div class="form-group">
              <label for="products">Product Name:</label>
              <select name="productId" class="form-control" style="max-width: 450px;">
                <option disabled selected>Select Productname</option>
                <% for(let i=0;i<productDet?.length;i++){ %>
                  <option value="<%=productDet[i]?._id%>">
                    <%=productDet[i]?.productName%>
                  </option>
                  <% } %>
              </select>
            </div>
            <div class="form-group">
              <label for="startDate">Start Date:</label>
              <input type="date" class="form-control" id="startDate" name="startDate">
            </div>
            <div class="form-group">
              <label for="expiryDate">Expiry Date:</label>
              <input type="date" class="form-control" id="expiryDate" name="expiryDate">
            </div>
            <div class="form-group">
              <label for="offerPercentage">Offer Percentage:</label>
              <input type="number" class="form-control" id="offerPercentage" name="offerPercentage"
                placeholder="Enter offer percentage">
            </div>
          </div>
          <!-- Modal Footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary" id="saveButton">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th scope="col" class="fw-bold"><span class="lead">Product Name</span></th>
        <th scope="col" class="fw-bold"><span class="lead">Offer Percentage</span></th>
        <th scope="col" class="fw-bold"><span class="lead">Start Date</span></th>
        <th scope="col" class="fw-bold"><span class="lead">Expiry Date</span></th>
        <th scope="col" class="fw-bold"><span class="lead">Action</span></th>
      </tr>
    </thead>
    <tbody>
      <% for (let i=0; i<OfferDet.length;i++){ %>
      <tr>
        <th scope="row">
          <span class="lead"><%=productDet2[i]?.productName%></span>
        </th>
        <td>
          <span class="lead">%<%=OfferDet[i].offerPercentage%></span>
        </td>
        <td>
          <span class="lead"><%=OfferDet[i].startDate.toDateString()%></span>
        </td>
        <td>
          <span class="lead"><%=OfferDet[i].endDate.toDateString()%></span>
        </td>
        <td>
          <button   type="button" class="btn btn-primary" data-toggle="modal" data-target="#my2Modal<%= i %>">
            Open Modal
          </button>
          <div class="modal" id="my2Modal<%= i %>">
            <div class="modal-dialog">
              <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h4 class="modal-title">Product Details</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal Body -->
                <form id="productForm2">
                  <div class="modal-body">
                    <div class="form-group">
                      <label for="products">Product ID:</label>
                      
                      <input class="form-control" name="productId" id="ProductName"  value="<%=OfferDet[i].product%>">
                    </div>
                    <div class="form-group">
                      <label for="startDate">Start Date</label>
                      <input type="date" class="form-control" name="startDate" id="startDate" value="<%=OfferDet[i].startDate.toDateString()%>">
                    </div>
                    <div class="form-group">
                      <label for="expiryDate">Expiry Date:</label>
                      <input type="date" class="form-control" name="expiryDate" id="expiryDate"  value="<%=OfferDet[i].endDate.toDateString()%>">
                    </div>
                    <div class="form-group">
                      <label for="offerPercentage">Offer Percentage:</label>
                      <input type="number" name="offerPercentage" class="form-control" id="offerPercentage" value="<%=OfferDet[i].offerPercentage%>"
                        placeholder="Enter offer percentage">
                    </div>
                  </div>
                  <!-- Modal Footer -->
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="saveButton">Save</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </td> 
          
        </tr>
       
        
      <% } %>
    </tbody>
  </table>
  <script>

    $("#productForm").validate({
      rules: {
        productName: "required",
        startDate: "required",
        expiryDate: "required",
        offerPercentage: {
          required: true,
          number: true,
          min: 0,
          max: 90,
        }
      },
      messages: {
        productName: "Please enter a product name",
        startDate: "Please enter a start date",
        expiryDate: "Please enter an expiry date",
        offerPercentage: {
          required: "Please enter an offer percentage",
          number: "Please enter a valid number",
          min: "Offer percentage must be greater than or equal to 0",
          max: "Offer percentage must be less than or equal to 100"
        }
      },
      errorElement: "div",
      errorPlacement: function (error, element) {
        error.addClass("invalid-feedback");
        error.insertAfter(element);
      },
      highlight: function (element, errorClass, validClass) {
        $(element).addClass("is-invalid").removeClass("is-valid");
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).removeClass("is-invalid").addClass("is-valid");
      },

      submitHandler: async function (form,event) {
        event.preventDefault()
        const formData = $(form).serializeArray();
        const jsonData = {};
        formData.forEach(field => {
          jsonData[field.name] = field.value;
        });

        // Submit data using Fetch API
        let response = await fetch('/productOfferDet', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonData)
        });

        let result = await response.json()
        if (result.success) {
          await Swal.fire({
            icon: "success",
            title: " productOffer added",
          });
          window.location.reload()
        }
      }
    });


  </script>
  <script>
    $("#productForm2").validate({
      rules: {
        productName: "required",
        startDate: "required",
        expiryDate: "required",
        offerPercentage: {
          required: true,
          number: true,
          min: 0,
          max: 90,
        }
      },
      messages: {
        productName: "Please enter a product name",
        startDate: "Please enter a start date",
        expiryDate: "Please enter an expiry date",
        offerPercentage: {
          required: "Please enter an offer percentage",
          number: "Please enter a valid number",
          min: "Offer percentage must be greater than or equal to 0",
          max: "Offer percentage must be less than or equal to 100"
        }
      },
      errorElement: "div",
      errorPlacement: function (error, element) {
        error.addClass("invalid-feedback");
        error.insertAfter(element);
      },
      highlight: function (element, errorClass, validClass) {
        $(element).addClass("is-invalid").removeClass("is-valid");
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).removeClass("is-invalid").addClass("is-valid");
      },

      submitHandler: async function (form,event) {
        event.preventDefault()
        const formData = $(form).serializeArray();
        const jsonData = {};
        formData.forEach(field => {
          jsonData[field.name] = field.value;
        });

        // Submit data using Fetch API
        let response = await fetch('/productOfferedit', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonData)
        });

        let result = await response.json()
        if (result.success) {
          await Swal.fire({
            icon: "success",
            title: " productOffer eddited",
          });
          window.location.reload()
        }
      }
    });


  </script>
 <script>
  // JavaScript to handle the click event
$(document).on('click', '#unblock', function() {
  $('#editModal').modal('show');
});

 </script>

  // </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.min.js"></script>

</body>

</html>